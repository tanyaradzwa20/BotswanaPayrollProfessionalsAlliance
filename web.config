<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <!-- Enable static content caching -->
        <staticContent>
            <!-- Set default cache for all static files -->
            <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="365.00:00:00" />
        </staticContent>
        
        <!-- Custom headers for fine-grained cache control -->
        <httpProtocol>
            <customHeaders>
                <!-- Remove default headers that might interfere -->
                <remove name="X-Powered-By" />
            </customHeaders>
        </httpProtocol>
        
        <!-- Compression for better performance -->
        <httpCompression directory="%SystemDrive%\inetpub\temp\IIS Temporary Compressed Files">
            <scheme name="gzip" dll="%Windir%\system32\inetsrv\gzip.dll"/>
            <dynamicTypes>
                <add mimeType="text/*" enabled="true"/>
                <add mimeType="message/*" enabled="true"/>
                <add mimeType="application/javascript" enabled="true"/>
                <add mimeType="application/x-javascript" enabled="true"/>
                <add mimeType="application/json" enabled="true"/>
                <add mimeType="*/*" enabled="false"/>
            </dynamicTypes>
            <staticTypes>
                <add mimeType="text/*" enabled="true"/>
                <add mimeType="message/*" enabled="true"/>
                <add mimeType="application/javascript" enabled="true"/>
                <add mimeType="application/x-javascript" enabled="true"/>
                <add mimeType="application/atom+xml" enabled="true"/>
                <add mimeType="application/xaml+xml" enabled="true"/>
                <add mimeType="image/svg+xml" enabled="true"/>
                <add mimeType="*/*" enabled="false"/>
            </staticTypes>
        </httpCompression>
        <urlCompression doStaticCompression="true" doDynamicCompression="true"/>
        
        <!-- Specific cache rules by file type -->
        <rewrite>
            <outboundRules>
                <!-- HTML files - 1 hour cache -->
                <rule name="Cache HTML" preCondition="IsHTML">
                    <match serverVariable="RESPONSE_Cache-Control" pattern=".*" />
                    <action type="Rewrite" value="public, max-age=3600" />
                </rule>
                
                <!-- CSS and JS files - 1 year cache with immutable -->
                <rule name="Cache CSS and JS" preCondition="IsCSSorJS">
                    <match serverVariable="RESPONSE_Cache-Control" pattern=".*" />
                    <action type="Rewrite" value="public, max-age=31536000, immutable" />
                </rule>
                
                <!-- Images - 1 year cache -->
                <rule name="Cache Images" preCondition="IsImage">
                    <match serverVariable="RESPONSE_Cache-Control" pattern=".*" />
                    <action type="Rewrite" value="public, max-age=31536000, immutable" />
                </rule>
                
                <!-- Fonts - 1 year cache -->
                <rule name="Cache Fonts" preCondition="IsFont">
                    <match serverVariable="RESPONSE_Cache-Control" pattern=".*" />
                    <action type="Rewrite" value="public, max-age=31536000, immutable" />
                </rule>
                
                <preConditions>
                    <preCondition name="IsHTML">
                        <add input="{RESPONSE_CONTENT_TYPE}" pattern="^text/html" />
                    </preCondition>
                    <preCondition name="IsCSSorJS">
                        <add input="{REQUEST_FILENAME}" pattern="\.(css|js)$" />
                    </preCondition>
                    <preCondition name="IsImage">
                        <add input="{REQUEST_FILENAME}" pattern="\.(jpg|jpeg|png|gif|webp|svg|ico)$" />
                    </preCondition>
                    <preCondition name="IsFont">
                        <add input="{REQUEST_FILENAME}" pattern="\.(ttf|otf|woff|woff2|eot)$" />
                    </preCondition>
                </preConditions>
            </outboundRules>
        </rewrite>
    </system.webServer>
</configuration>
